# This is an improved Caddyfile with logging enabled for the Joomart staging environment

## SPA Frontend (Vue.js) - Handles staging.joomart.local

staging.joomart.local {
    tls internal

    reverse_proxy http://frontend:5173
    handle /api/* {
        rewrite * /index.php{uri}
        php_fastcgi api:9000
    }   

    header /public/* Cache-Control "public, max-age=31536000, immutable"

    log {
        output stdout
        format console
    }
 
}

## API (Laravel) - Handles api.staging.joomart.local

api.staging.joomart.local {
    tls internal
    root * /var/www/html/public
    
    # Serve static files directly
    file_server

    # Handle PHP (Laravel bootstrap)
    php_fastcgi api:9000

    encode gzip zstd

    log {
        output stdout
        format console
    }
}


## BACKEND (Next.js) - Handles admin.staging.joomart.local

admin.staging.joomart.local {
    tls internal
    reverse_proxy http://backend:3000
    
    log {
        output stdout
        format console
    }
}
