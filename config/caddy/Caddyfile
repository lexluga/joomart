# This is an improved Caddyfile with logging enabled for the Joomart staging environment.

## Frontend (Vue.js SPA) - Handles staging.joomart.xyz

staging.joomart.xyz {
    # Caddy will automatically get an SSL certificate and redirect
    # all HTTP traffic to HTTPS.

    # Serve the static files for the Vue.js Single Page Application (SPA).
    root * /var/www/html
    try_files {path} {path}/ /index.html

    # This handles the reverse proxy for API requests starting with '/api/'.
    handle /api/* {
        reverse_proxy http://api:9000
    }

    # A simple `file_server` to serve the static content of the SPA.
    file_server

    # --- Logging Configuration ---
    # This block logs all incoming requests for this site.
    log {
        # The access log format can be customized. Common options include:
        # json, single_field, or a custom format. 'json' is great for structured logs.
        format json
        # The output destination. 'stdout' will print to the console.
        # You can also specify a file path like 'file /var/log/caddy/staging_access.log'
        output stdout
    }
}

---

## API (Laravel) - Handles api.staging.joomart.xyz

api.staging.joomart.xyz {
    # This block handles the API subdomain.
    reverse_proxy http://api:9000

    # --- Logging Configuration ---
    log {
        format json
        output stdout
    }
}

---

## Backend (Next.js) - Handles admin.staging.joomart.xyz

admin.staging.joomart.xyz {
    # This block handles the admin subdomain.
    reverse_proxy http://backend:5000

    # --- Logging Configuration ---
    log {
        format json
        output stdout
    }
}
